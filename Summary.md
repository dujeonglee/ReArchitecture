# WiFi Driver Architecture - 전체 관계도

## 1. 전체 구조

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     │
│                                         User Space                                                  │
│                                    (wpa_supplicant, hostapd)                                        │
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                │
                                                ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    cfg80211 / nl80211 (Kernel)                                      │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                │
════════════════════════════════════════════════╪═════════════════════════════════════════════════════
                                                │           DRIVER BOUNDARY
                                                ▼
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                  │
│  ┌───────────────────┐                                                                                                                           │
│  │                   │         ┌─────────────────────────────────────────────────────────────────┐                                               │
│  │                   │         │                        LAYERED ARCHITECTURE                     │                                               │
│  │                   │         ├─────────────────────────────────────────────────────────────────┤                                               │
│  │                   │         │                                                                 │     ┌─────────────────────────────────────┐   │
│  │                   │  init   │  ┌─────────────────────────────────────────────────────────┐    │     │                                     │   │
│  │                   ├────────►│  │  Layer 2: Kernel Interface (cfg80211_if, netdev_if)     │    │     │              CROSS-CUTTING MODULES  │   │
│  │                   │         │  └─────────────────────────────────────────────────────────┘    │     │                                     │   │
│  │                   │         │                              │                                  │     │  ┌──────────────┐  ┌──────────────┐ │   │
│  │     LIFECYCLE     │         │                              ▼                                  │     │  │  MONITORING  │  │  DIAGNOSTIC  │ │   │
│  │      MANAGER      │         │  ┌─────────────────────────────────────────────────────────┐    │     │  │  ──────────  │  │  ──────────  │ │   │
│  │                   │         │  │  Layer 3: Service Manager (vif_mgr, svc_sta, svc_mhs)   │    │     │  │  traffic_mon │  │  pkt_capture │ │   │
│  │   ┌───────────┐   │         │  └─────────────────────────────────────────────────────────┘    │     │  │  stats_mgr   │  │  debug_mgr   │ │   │
│  │   │ drv_init  │   │         │                              │                                  │     │  │  health_mon  │  │  log_collect │ │   │
│  │   ├───────────┤   │         │                              ▼                                  │     │  └──────────────┘  └──────────────┘ │   │
│  │   │ drv_recov │   │ start   │  ┌─────────────────────────────────────────────────────────┐    │     │                                     │   │
│  │   ├───────────┤   ├────────►│  │  Layer 4: Core (sme_sta, sme_ap, mlme, ma, security)    │    │     │  ┌──────────────┐  ┌──────────────┐ │   │
│  │   │ drv_power │   │ stop    │  └─────────────────────────────────────────────────────────┘    │     │  │      RF      │  │ COORDINATION │ │   │
│  │   └───────────┘   │         │                              │                                  │     │  │      ──      │  │ ──────────── │ │   │
│  │                   │         │                              ▼                                  │     │  │     tas      │  │ panel_notif  │ │   │
│  │                   │         │  ┌─────────────────────────────────────────────────────────┐    │     │  │     dpd      │  │ ril_notif    │ │   │
│  │                   │ suspend │  │  Layer 5: FW Message (msg_router, msg_builder)          │    │     │  └──────────────┘  └──────────────┘ │   │
│  │                   ├────────►│  └─────────────────────────────────────────────────────────┘    │     │  ┌──────────────┐  ┌────────────┐   │   │
│  │                   │ resume  │                              │                                  │     │  │    POLICY    │  │ REGULATORY │   │   │
│  │                   │         │                              ▼                                  │     │  │    ──────    │  │ ────────── │   │   │
│  │                   │         │  ┌─────────────────────────────────────────────────────────┐    │     │  │  load_bal    │  │            │   │   │
│  │                   │ recover │  │  Layer 6: HIP (hip_core, bus abstraction)               │    │     │  │  qos_mgr     │  │  reg_dom   │   │   │
│  │                   ├────────►│  └─────────────────────────────────────────────────────────┘    │     │  │              │  │            │   │   │
│  │                   │         │                                                                 │     │  └──────────────┘  └────────────┘   │   │
│  │                   │         ├─────────────────────────────────────────────────────────────────┤     └─────────────────────────────────────┘   │
│  │                   │         │  Layer 1: OSAL (memory, sync, timer, skb)                       │                        │                      │
│  └─────────┬─────────┘         └─────────────────────────────────────────────────────────────────┘                        │                      │
│            │                                              │                                                               │                      │
│            │  init                                        │                                                               │                      │
│            ├──────────────────────────────────────────────┼───────────────────────────────────────────────────────────────┘                      │
│            │         ┌────────────────────────────────────┼────────────────────────────────────┐                                                 │
│            │         │  Layer 7: CUSTOMER EXTENSION       │                                    │                                                 │
│            │  init   │  ────────────────────────────      │                                    │                                                 │
│            ├────────►│  customer_hooks ◄──────────────────┘                                    │                                                 │
│            │         │  vendor_modules                     (Hook based call)                   │                                                 │     
│            │         └─────────────────────────────────────────────────────────────────────────┘                                                 │
│                                                                                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                │
════════════════════════════════════════════════╪═════════════════════════════════════════════════════
                                                │           HW BOUNDARY
                                                ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         Firmware (FullMAC)                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```
